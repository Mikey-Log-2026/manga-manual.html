<div id="narrationBox">
    <div id="mangaStatus" style="font-size: 0.8em; color: #0056b3; margin-bottom: 5px;"></div>
    <div id="speechText">ボタンを押すとDX体験が始まります</div>
</div>

<script>
    // 4コマ分のセリフデータ
    const mangaScripts = [
        { label: "【1コマ目】", text: "「あぁ！また誰がフォークリフト持っていったか分からないよ…」" },
        { label: "【2コマ目】", text: "「探す時間がもったいない！紙の台帳もグチャグチャだわ。」" },
        { label: "【3コマ目】", text: "「そこで、マイキーログを導入！スマホをかざすだけでOK！」" },
        { label: "【4コマ目】", text: "「誰が、いつ、何を借りたのか自動で記録。管理の手間もゼロで、安心100パーセント！」" }
    ];

    let currentStep = 0;
    let isPlaying = false;

    async function playDXExperience() {
        if (isPlaying) return; // 再生中は重複防止
        isPlaying = true;

        const statusLabel = document.getElementById('mangaStatus');
        const speechText = document.getElementById('speechText');
        const box = document.getElementById('narrationBox');
        box.style.opacity = '1';

        for (let i = 0; i < mangaScripts.length; i++) {
            const script = mangaScripts[i];
            
            // 1. 画面表示の更新
            statusLabel.innerText = script.label;
            speechText.innerText = script.text;

            // 2. 効果音（各コマの切り替わり）
            playBeep();

            // 3. 音声読み上げ
            await speakText(script.text);

            // 4. 少し待機（次のコマへ）
            await new Promise(resolve => setTimeout(resolve, 800));
        }

        isPlaying = false;
        statusLabel.innerText = "完了";
    }

    // 効果音を鳴らす関数
    function playBeep() {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.frequency.setValueAtTime(1000, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    // 音声を読み上げ、終わるまで待機する関数
    function speakText(text) {
        return new Promise((resolve) => {
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = "ja-JP";
            uttr.rate = 1.2; // 少しテンポよく
            
            // 読み上げ終了時にPromiseを解決
            uttr.onend = () => resolve();
            window.speechSynthesis.speak(uttr);
        });
    }
</script>
